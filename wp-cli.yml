apache_modules:
  - mod_rewrite

core config:
  dbuser: wp
  dbpass: xxx
  dbname: wordpress
  dbprefix: wp_
  dbhost: db:3306
  extra-php: |

    # Disable internal Wp-Cron function
		# @krn we have no classic cron
    # define('DISABLE_WP_CRON', true);


    function checkVarForBool($val) {
      if(strval($val) === "false") {
        return false;
      }
      if(strval($val) === "true") {
        return true;
      }
      return $val;
    }

    function _define_by_env_vars($config_name, $config_value_fallback) {
      define($config_name, getenv($config_name) !== false ? checkVarForBool(getenv($config_name)) : checkVarForBool($config_value_fallback));
    }
    $host = $_SERVER['REQUEST_SCHEME'] . '://' . $_SERVER['HTTP_HOST'];

    # SSL by default
    if (strpos($_SERVER['HTTP_X_FORWARDED_PROTO'], 'https') !== false) $_SERVER['HTTPS']='on';
    define('FORCE_SSL_ADMIN', true);
    if(isset($_SERVER['HTTP_X_FORWARDED_PROTO'])) {
        $host = $_SERVER['HTTP_X_FORWARDED_PROTO'] . '://' . $_SERVER['HTTP_HOST'];
    }

    # no revisions
    # define( 'WP_POST_REVISIONS', false );
    # define('AUTOSAVE_INTERVAL', 86400*30);

		## Disable Editing in Dashboard
    # define('DISALLOW_FILE_EDIT', true);

    _define_by_env_vars('WP_SITEURL', $host);
    _define_by_env_vars('WP_REDIS_DISABLED', false);
    _define_by_env_vars('WP_HOME', $host);

    # REDIS OBJECT CACHE
    # define('WP_REDIS_HOST', 'redis');
    # define('WP_REDIS_DATABASE', 4);
    # define('WP_REDIS_MAXTTL', 800);
    # define('WP_REDIS_IGNORED_GROUPS', ['plugins', 'posts', 'post_meta', 'acf']);

    _define_by_env_vars('WP_DEBUG', false);
    _define_by_env_vars('WP_DEBUG_LOG', false);
    _define_by_env_vars('WP_DEBUG_DISPLAY', true);
    _define_by_env_vars('CUSTOM_WP_ENV', 'prod');

    if(WP_DEBUG) {
      define( 'SAVEQUERIES', true );
    }

    # WP_ENV
    _define_by_env_vars('WP_ENV', "local_dev");

    # WP Default Language
    define('WPLANG', 'de_DE');

    # Salts
    # for demo purpose dynamic generated by: https://api.wordpress.org/secret-key/1.1/salt/
    define('AUTH_KEY',         'l50y)b!K,P9_}EaVEArGBtaai?;Bv&v_`g%}d?[ccE8&l$/6+3}6AU7|h^dIq2Cn');
    define('SECURE_AUTH_KEY',  'UWZu 4cW0z0$IB][4&I_k+65Vl^T}(uqfpHh$Ef;0nQC.aYBw}J^]|{f2Kh6)oN*');
    define('LOGGED_IN_KEY',    'eVH+b>jwQOy14}fhc{daOc}0VI_6CrKE-c^coR75/@a+AU-~JFKey(T-XDh+0o-|');
    define('NONCE_KEY',        '2u!syL?(B~uj>nq6!sT&4cGC22m&?`-vsd@B|dlyd:C!0b;QF|{;qwveQ_0FoTMs');
    define('AUTH_SALT',        ')*Fu<^~Ly[M`6y,`mI0mwn[yl|/;n)uQC<u,Yt?.dxTNP}2Q!}VdP^H{/|P,ad7^');
    define('SECURE_AUTH_SALT', '65FCb%WwlI_u$T|jOy:->G!txH+&$*]ok?hxQS41(Fb0Z)MS~z7#5i|(`+P9Ja&e');
    define('LOGGED_IN_SALT',   'bFguo1-K{uXc)O%}mvFv ^ida(S;^e&aaC;dkB[]YTF%_Sc,]R{0|r6vIk&fR#L8');
    define('NONCE_SALT',       '*j.;8t5C=bZiq`i#Yn-B@=3_`Y=Pvt+aHuDz#T?``qf)Zuc e<(In&V##H!?^:zZ');

    # sentry
    # _define_by_env_vars('KRN_SENTRY_DSN', 'DSN');
    # _define_by_env_vars('KRN_SENTRY_PUBLIC_DSN', 'DSN');
		# sentry only on prod
    # if(WP_ENV != "local_dev") {
    #  define( 'WP_SENTRY_DSN', KRN_SENTRY_DSN);
    # define( 'WP_SENTRY_PUBLIC_DSN', KRN_SENTRY_PUBLIC_DSN );
    # }
    # _define_by_env_vars('WP_SENTRY_ENV', 'undefined');
    # _define_by_env_vars('WP_SENTRY_VERSION', 'undefined');


    # multi DB
    _define_by_env_vars('KRN_DATABASES', 'undefined');

    # enable error reporting
    if(!WP_DEBUG) {
      @ini_set("display_errors", 0);
      error_reporting(E_ALL);
    }


core install:
  url: localhost:8080
  title: wordpress
  admin_user:
  admin_password:
  admin_email: admin@wordpress.com
  skip-email: true
